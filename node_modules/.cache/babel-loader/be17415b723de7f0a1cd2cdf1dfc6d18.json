{"ast":null,"code":"var _jsxFileName = \"/Users/mhd.sad22/graduation-project/graduation-project/src/components/MyClasses.js\";\nimport { Button } from 'react-bootstrap';\nimport React, { Component } from 'react';\nimport noImage from '../noImage.png';\nimport StudentsTable from './StudentsTable';\nimport Details from './Details';\nimport History from './History';\nimport { storage } from '../firebase/index';\nimport EditClass from './EditClass';\nimport { Redirect, Route } from 'react-router-dom';\n\nclass MyClasses extends Component {\n  constructor() {\n    super();\n\n    this.checkLoggedIn = () => {\n      const data = sessionStorage.getItem('teacher');\n\n      if (!data) {\n        this.setState({\n          route: '/login'\n        });\n        return false;\n      } else {\n        return true;\n      }\n    };\n\n    this.checkAttendence = e => {\n      this.setState({\n        load: true,\n        doneDisable: true\n      }); //Create a reader to read an uploaded file .\n\n      let reader = new FileReader();\n      reader.readAsDataURL(e.target.files[0]);\n\n      reader.onload = event => {\n        //Get the uploaded image and store it in let image .\n        let image = new Image();\n        image.src = event.target.result; //Create to letiable to store image width and height .\n\n        let imgHeight, imgWidth;\n\n        image.onload = async function () {\n          imgHeight = this.height;\n          imgWidth = this.width; //The function will store width and height values in State . \n\n          setData();\n        };\n\n        let setData = () => {\n          this.setState({\n            width: imgWidth,\n            height: imgHeight\n          });\n        };\n      };\n\n      const img = e.target;\n\n      if (img) {\n        this.setState({\n          file2: e.target.files[0],\n          file: URL.createObjectURL(e.target.files[0])\n        });\n        this.faceRecognition(img.files[0]);\n      }\n\n      e.target.value = null;\n    };\n\n    this.setShowBtn = () => {\n      this.setState({\n        showUploadBtn: true\n      });\n    };\n\n    this.sendHistoryData = () => {\n      let requestOptions = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          'ids': this.state.ids,\n          'imgs': this.state.imgs\n        })\n      };\n      let baseUrl = document.getElementById('baseUrl').value;\n      fetch(`${baseUrl}/history/${this.state.selected_class}`, requestOptions).then(res => res.json()).then(console.log).catch(e => {\n        console.log(\"An Error occured while sending history Data ..\", e);\n      });\n      let date = new Date();\n      let fullDate = date.getDate() + \"/\" + (date.getMonth() + 1) + \"/\" + date.getFullYear();\n      let historyData = {\n        students: this.state.ids,\n        allStudents: this.state.students,\n        imgs: this.state.imgs,\n        className: this.state.selected_class,\n        date: fullDate\n      };\n      this.setState({\n        ids: [],\n        imgs: [],\n        selected_class: [],\n        historyData: historyData,\n        disableButton: true,\n        route: '/show/details'\n      });\n    };\n\n    this.faceRecognition = img => {\n      let formdata = new FormData();\n      formdata.append(\"photo\", img, \"file\");\n      let requestOptions = {\n        method: 'POST',\n        body: formdata,\n        redirect: 'follow'\n      };\n      let baseUrl = document.getElementById('baseUrl').value;\n      fetch(`${baseUrl}/checkImage`, requestOptions).then(response => response.json()).then(result => {\n        console.log(result); //Define canvas to draw rectangle .\n\n        let canvas = document.getElementById('canvas');\n        let ctx = canvas.getContext('2d'); //Canvas properties .\n\n        ctx.strokeStyle = 'yellow';\n        ctx.fillStyle = 'yellow';\n        ctx.lineWidth = '5'; //Change the background of context to the uploaded image .\n\n        let image = document.getElementById('person');\n        ctx.drawImage(image, 0, 0);\n        let studetnsIDs = this.state.students.map(std => {\n          return std.id;\n        });\n        let {\n          ids\n        } = this.state;\n\n        for (let i in result) {\n          let name = result[i].name.substring(0, result[i].name.indexOf('|'));\n          let id = result[i].name.substring(result[i].name.indexOf('|') + 2);\n\n          if (!studetnsIDs.includes(id)) {\n            continue;\n          }\n\n          if (result[i].probability * 100 < 90) {\n            continue;\n          }\n\n          if (!ids.includes(id)) {\n            ids.push(id);\n          } //Get the values of Rectangle .\n\n\n          let {\n            left,\n            right,\n            bottom,\n            top\n          } = result[i].rectangle; //Determine the width and hight for rectangle .\n\n          let Dim = right - left; //Determine font size and the space between rectangle and text .\n\n          let space = parseInt(Dim / 3),\n              text = `${space}px Lobster`;\n          ctx.font = text; //Draw the rectangle .\n\n          ctx.strokeRect(left, top, Dim, Dim); //Type the name of person .\n\n          ctx.fillText(name, left, bottom + space);\n        }\n\n        let attendStudents = [];\n        let absenceStudents = [];\n\n        for (let i of this.state.students) {\n          let flag = false;\n\n          for (let j of this.state.ids) {\n            if (i.id === j) {\n              flag = true;\n            }\n          }\n\n          if (flag) {\n            attendStudents.push({\n              id: i.id,\n              name: i.name\n            });\n          } else {\n            absenceStudents.push({\n              id: i.id,\n              name: i.name\n            });\n          }\n        }\n\n        this.setState({\n          ids: ids,\n          attendStudents,\n          absenceStudents // imgs : [imagesLink]\n\n        });\n        let space = this.state.width / 20;\n        ctx.fillStyle = 'black';\n        let text = `${space}px serif`;\n        ctx.font = text;\n        ctx.fillText(new Date().toLocaleString(), this.state.width / 2 - 5 * space, 50);\n        this.setState({\n          showImage: false\n        }); // Store image in firebase ........\n\n        let dataURL = canvas.toDataURL(\"image/png\");\n        console.log(ids);\n        this.setState({\n          file: dataURL\n        });\n        let formdata = this.getImageURL(dataURL);\n        this.convertImageToURL(formdata.get('image'));\n        console.log(\"Imgs : \", this.state.imgs);\n        this.colorTable(result);\n        this.setState({\n          load: false\n        });\n      }).catch(error => console.log('error', error));\n    };\n\n    this.colorTable = () => {\n      let {\n        ids\n      } = this.state;\n\n      for (let i of ids) {\n        let row = document.getElementById(i + \"\");\n\n        if (row) {\n          row.className = 'bg-success text-light';\n        }\n      }\n    };\n\n    this.clear = () => {\n      this.setState({\n        showImage: true,\n        showUploadBtn: false\n      });\n      let {\n        students\n      } = this.state;\n\n      for (let student of students) {\n        document.getElementById(student.id).className = '';\n      }\n    };\n\n    this.CheckClass = e => {\n      const name = e.target.getAttribute('data-class');\n      this.setState({\n        selected_class: name\n      });\n      let arr = [];\n      this.state.classes.forEach(element => {\n        if (element.className === name) {\n          element.students.forEach(std => {\n            arr.push({\n              id: std.id_number,\n              name: std.firstName + \" \" + std.lastName\n            });\n          });\n        }\n      });\n      this.setState({\n        ids: [],\n        imgs: [],\n        students: arr,\n        hidePage: true,\n        showStudents: arr,\n        route: '/show/classData'\n      });\n    };\n\n    this.editClass = () => {\n      this.setState({\n        direction: 'edit',\n        route: '/show/editClass'\n      });\n    };\n\n    this.back = () => {\n      this.setState({\n        hidePage: false,\n        route: '/show'\n      });\n      this.clear();\n    };\n\n    this.showHistoryPage = () => {\n      this.setState({\n        route: '/show/classHistory'\n      });\n    };\n\n    this.showAllStudents = () => {\n      let showStudents = this.state.students;\n      this.setState({\n        showStudents\n      });\n      this.colorTable();\n    };\n\n    this.showAttendStudents = () => {\n      let showStudents = this.state.attendStudents;\n      this.setState({\n        showStudents\n      });\n    };\n\n    this.showAbcentStudents = () => {\n      let showStudents = this.state.absenceStudents;\n      this.setState({\n        showStudents\n      });\n    };\n\n    this.onChangeRoute = route => {\n      setTim;\n      console.log(route, \"clicked\");\n\n      if (this.checkLoggedIn()) {\n        let baseUrl = document.getElementById('baseUrl').value;\n        fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number).then(res => res.json()).then(data => {\n          this.setState({\n            classes: data,\n            route\n          });\n        }).catch(e => console.log(e));\n      }\n    };\n\n    this.state = {\n      file: null,\n      width: 0,\n      height: 0,\n      ids: [],\n      students: [],\n      absenceStudents: [],\n      attendStudents: [],\n      showImage: true,\n      showUploadBtn: false,\n      load: false,\n      hidePage: false,\n      classes: [],\n      selected_class: '',\n      imgs: [],\n      faces: [],\n      disableButton: false,\n      direction: 'check',\n      // OR history , details , edit\n      historyData: {},\n      route: null,\n      doneDisable: true,\n      showStudents: []\n    };\n  } // Get all the classes for the logged in teacher .\n\n\n  componentDidMount() {\n    if (this.checkLoggedIn()) {\n      let baseUrl = document.getElementById('baseUrl').value;\n      fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number).then(res => res.json()).then(data => {\n        this.setState({\n          classes: data\n        });\n      }).catch(e => console.log(e));\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log(prevState.classes, \"\\n current: \\n\", this.state.classes);\n\n    if (prevState.classes.length === 0) {\n      if (this.checkLoggedIn()) {\n        let baseUrl = document.getElementById('baseUrl').value;\n        fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number).then(res => res.json()).then(data => {\n          this.setState({\n            classes: data\n          });\n        }).catch(e => console.log(e));\n      }\n    }\n  } //To Check if LoggedIn .\n\n\n  getImageURL(dataURL) {\n    let blobBin = atob(dataURL.split(',')[1]);\n    let array = [];\n\n    for (let i = 0; i < blobBin.length; i++) {\n      array.push(blobBin.charCodeAt(i));\n    }\n\n    let file = new Blob([new Uint8Array(array)], {\n      type: 'image/png'\n    });\n    let formdata = new FormData();\n    formdata.append(\"image\", file);\n    return formdata;\n  }\n\n  convertImageToURL(image) {\n    if (image) {\n      let imageName = \"studentsImage\" + new Date().getTime();\n      const upload = storage.ref(`images/${imageName}`).put(image);\n      upload.on('state_changed', snapshot => {}, err => {\n        console.log(\"error while getting data from firebase.\\n\", err);\n        return '';\n      }, () => {\n        storage.ref('images').child(imageName).getDownloadURL().then(urll => {\n          console.log(urll);\n          let imgs = [].concat(this.state.imgs);\n          imgs.push(urll);\n          this.setState({\n            imgs: imgs,\n            doneDisable: false\n          });\n          return urll;\n        });\n      });\n    }\n  } // To change the row color according to the attendence .\n\n\n  render() {\n    let {\n      path\n    } = this.props.match;\n    let classInfo = {\n      'students': this.state.students,\n      'className': this.state.selected_class\n    };\n    let bgColors = ['bg-dark', 'bg-primary', 'bg-info', 'bg-success', 'bg-secondary'];\n    let rows = this.state.classes.map(cs => {\n      const num = parseInt(Math.random() * bgColors.length);\n      const classNames = `${bgColors[num]} col-md-5 ml-1 class rounded mt-1 text-center text-light cursor`;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        onClick: this.CheckClass,\n        key: cs._id,\n        \"data-class\": cs.className,\n        \"data-student\": cs.students,\n        id: cs._id,\n        className: classNames,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 452,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"h1\", {\n        \"data-class\": cs.className,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 21\n        }\n      }, cs.className), /*#__PURE__*/React.createElement(\"p\", {\n        \"data-class\": cs.className,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 21\n        }\n      }, \"Students : \", cs.students.length));\n    });\n    return /*#__PURE__*/React.createElement(React.Fragment, null, this.state.route ? /*#__PURE__*/React.createElement(Redirect, {\n      to: this.state.route,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 37\n      }\n    }) : null, /*#__PURE__*/React.createElement(Route, {\n      path: `${path}/editClass`,\n      component: () => /*#__PURE__*/React.createElement(EditClass, {\n        classInfo: classInfo,\n        onChangeRoute: this.onChangeRoute,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 68\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: `${path}/classHistory`,\n      component: () => /*#__PURE__*/React.createElement(History, {\n        selected_class: this.state.selected_class,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 468,\n          columnNumber: 71\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: `${path}/details`,\n      component: () => /*#__PURE__*/React.createElement(Details, {\n        historyData: this.state.historyData,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 469,\n          columnNumber: 66\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: `${path}`,\n      exact: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      className: \"main-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 25\n      }\n    }, \"Select A Class\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row d-flex justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 25\n      }\n    }, rows))), /*#__PURE__*/React.createElement(Route, {\n      path: `${path}/classData`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"loading\",\n      hidden: !this.state.load,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 29\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 29\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 29\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"circle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 29\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-between\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      hidden: this.state.load,\n      onClick: this.editClass,\n      className: \" mt4 btn btn-info shadow grow\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 29\n      }\n    }, \"Edit Students\"), /*#__PURE__*/React.createElement(\"button\", {\n      hidden: this.state.load,\n      onClick: this.showHistoryPage,\n      className: \" mt4 btn btn-warning shadow grow\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 29\n      }\n    }, \"History\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      hidden: this.state.load,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 492,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      className: \"mt-2\",\n      style: {\n        fontFamily: 'Lobster',\n        color: '#343a40'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 497,\n        columnNumber: 33\n      }\n    }, \"Student of the course\"), /*#__PURE__*/React.createElement(StudentsTable, {\n      students: this.state.showStudents,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 498,\n        columnNumber: 33\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex justify-content-around\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.showAllStudents,\n      className: \"btn btn-dark br4 grow shadow dim\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 37\n      }\n    }, \"All Students\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.showAttendStudents,\n      className: \"btn btn-success br4 grow shadow dim\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 37\n      }\n    }, \"Attendance Students\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.showAbcentStudents,\n      className: \"btn btn-danger  br4 grow shadow dim\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 37\n      }\n    }, \"Absence Students\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-6 align-self-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"mt-2 grow pointer\",\n      onClick: this.back,\n      src: \"https://img.icons8.com/fluent/48/000000/circled-left.png\",\n      alt: \"go back\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 33\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      hidden: this.state.showUploadBtn,\n      onClick: this.setShowBtn,\n      style: {\n        width: '100%'\n      },\n      className: \"btn f3 grow btn-dark btn-submit mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 508,\n        columnNumber: 33\n      }\n    }, \"Check Attendence\"), /*#__PURE__*/React.createElement(\"div\", {\n      hidden: !this.state.showUploadBtn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      htmlFor: \"file2\",\n      style: {\n        width: '50%',\n        backgroundColor: 'darkcyan'\n      },\n      className: \"mt-3 grow f4 btn text-light btn-submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 510,\n        columnNumber: 37\n      }\n    }, this.state.ids.length === 0 ? 'Check Image' : 'Check another Image'), /*#__PURE__*/React.createElement(\"input\", {\n      hidden: true,\n      onChange: this.checkAttendence,\n      type: \"file\",\n      accept: \"image/*\",\n      id: \"file2\",\n      className: \"form-file mt-4\",\n      required: true,\n      disabled: this.state.disableButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 511,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      hidden: !this.state.showImage,\n      className: \"mt-5\",\n      style: {\n        fontFamily: 'Acme'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 37\n      }\n    }, \"To Check Attendence Upload an image for class student , then the system will check it .\"), /*#__PURE__*/React.createElement(\"p\", {\n      hidden: !this.state.showImage,\n      style: {\n        fontFamily: 'Acme'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"bg-success p-1 text-light rounded\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 102\n      }\n    }, \"Green\"), \" rows on table represents the Attendees student , and the \", /*#__PURE__*/React.createElement(\"span\", {\n      className: \"bg-dark p-1 text-light rounded\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 224\n      }\n    }, \"white\"), \" rows for Absence students . \"), /*#__PURE__*/React.createElement(\"img\", {\n      hidden: true,\n      id: \"person\",\n      src: this.state.file,\n      alt: \"Person\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"canvas\", {\n      id: \"canvas\",\n      width: this.state.width,\n      height: this.state.height,\n      hidden: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 520,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"img\", {\n      className: \"img-thumbnail mt-4\",\n      src: this.state.file || noImage,\n      alt: \"Person\",\n      width: \"300\",\n      height: \"300\",\n      hidden: this.state.showImage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      hidden: this.state.showImage,\n      onClick: this.clear,\n      style: {\n        width: '30%'\n      },\n      className: \"btn f3 grow btn-warning btn-submit mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 525,\n        columnNumber: 37\n      }\n    }, \"Clear\"), /*#__PURE__*/React.createElement(\"a\", {\n      className: \"btn f3 grow btn-info btn-submit mt-4\",\n      style: {\n        width: '30%'\n      },\n      hidden: this.state.showImage,\n      href: `${this.state.file}`,\n      download: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 37\n      }\n    }, \"Download\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 527,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      hidden: this.state.showImage,\n      onClick: this.sendHistoryData,\n      style: {\n        width: '30%'\n      },\n      className: \"btn f3 grow btn-success btn-submit mt-4 mb-4\",\n      disabled: this.state.doneDisable,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 528,\n        columnNumber: 37\n      }\n    }, \"Done\")))))));\n  }\n\n}\n\nexport default MyClasses;","map":{"version":3,"sources":["/Users/mhd.sad22/graduation-project/graduation-project/src/components/MyClasses.js"],"names":["Button","React","Component","noImage","StudentsTable","Details","History","storage","EditClass","Redirect","Route","MyClasses","constructor","checkLoggedIn","data","sessionStorage","getItem","setState","route","checkAttendence","e","load","doneDisable","reader","FileReader","readAsDataURL","target","files","onload","event","image","Image","src","result","imgHeight","imgWidth","height","width","setData","img","file2","file","URL","createObjectURL","faceRecognition","value","setShowBtn","showUploadBtn","sendHistoryData","requestOptions","method","headers","body","JSON","stringify","state","ids","imgs","baseUrl","document","getElementById","fetch","selected_class","then","res","json","console","log","catch","date","Date","fullDate","getDate","getMonth","getFullYear","historyData","students","allStudents","className","disableButton","formdata","FormData","append","redirect","response","canvas","ctx","getContext","strokeStyle","fillStyle","lineWidth","drawImage","studetnsIDs","map","std","id","i","name","substring","indexOf","includes","probability","push","left","right","bottom","top","rectangle","Dim","space","parseInt","text","font","strokeRect","fillText","attendStudents","absenceStudents","flag","j","toLocaleString","showImage","dataURL","toDataURL","getImageURL","convertImageToURL","get","colorTable","error","row","clear","student","CheckClass","getAttribute","arr","classes","forEach","element","id_number","firstName","lastName","hidePage","showStudents","editClass","direction","back","showHistoryPage","showAllStudents","showAttendStudents","showAbcentStudents","onChangeRoute","setTim","parse","faces","componentDidMount","componentDidUpdate","prevProps","prevState","length","blobBin","atob","split","array","charCodeAt","Blob","Uint8Array","type","imageName","getTime","upload","ref","put","on","snapshot","err","child","getDownloadURL","urll","concat","render","path","props","match","classInfo","bgColors","rows","cs","num","Math","random","classNames","_id","fontFamily","color","backgroundColor"],"mappings":"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","sourcesContent":["import { Button } from 'react-bootstrap';\nimport React, { Component } from 'react';\nimport noImage from '../noImage.png';\nimport StudentsTable from './StudentsTable';\nimport Details from './Details';\nimport History from './History';\nimport { storage } from '../firebase/index';\nimport EditClass from './EditClass';\nimport { Redirect, Route} from 'react-router-dom';\n\nclass MyClasses extends Component {\n    constructor() {\n        super();\n        this.state = {\n            file: null,\n            width: 0,\n            height: 0,\n            ids: [],\n            students: [],\n            absenceStudents: [],\n            attendStudents: [],\n            showImage: true,\n            showUploadBtn: false,\n            load: false,\n            hidePage: false,\n            classes: [],\n            selected_class: '',\n            imgs: [],\n            faces: [],\n            disableButton: false,\n            direction: 'check', // OR history , details , edit\n            historyData: {},\n            route: null,\n            doneDisable: true ,\n            showStudents : [] \n        }\n    }\n\n    // Get all the classes for the logged in teacher .\n    componentDidMount() {\n        if(this.checkLoggedIn()){\n            let baseUrl= document.getElementById('baseUrl').value;\n            fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number)\n                .then(res => res.json()).then(data => {\n                    this.setState({\n                        classes: data,\n    \n                    })\n                })\n                .catch(e => console.log(e));\n        }\n    }\n\n    componentDidUpdate(prevProps,prevState) {\n        console.log(prevState.classes,\"\\n current: \\n\",this.state.classes);\n        if(prevState.classes.length === 0){\n            if(this.checkLoggedIn()){\n                let baseUrl= document.getElementById('baseUrl').value;\n                fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number)\n                    .then(res => res.json()).then(data => {\n                        this.setState({\n                            classes: data,\n        \n                        })\n                    })\n                    .catch(e => console.log(e));\n            }\n        }\n    }\n\n    //To Check if LoggedIn .\n    checkLoggedIn = () => {\n        const data = sessionStorage.getItem('teacher');\n        if (!data) {\n           this.setState({\n               route:'/login'\n           })\n           return false;\n        }\n        else {\n            return true;\n        }\n    }\n\n    // Will check the faces from the uploaded image .\n    checkAttendence = (e) => {\n        this.setState({\n            load: true,\n            doneDisable: true\n        });\n\n        //Create a reader to read an uploaded file .\n        let reader = new FileReader();\n        reader.readAsDataURL(e.target.files[0]);\n\n        reader.onload = (event) => {\n            //Get the uploaded image and store it in let image .\n            let image = new Image();\n            image.src = event.target.result;\n\n            //Create to letiable to store image width and height .\n            let imgHeight, imgWidth;\n            image.onload = async function () {\n                imgHeight = this.height;\n                imgWidth = this.width;\n\n                //The function will store width and height values in State . \n                setData();\n            }\n            let setData = () => {\n                this.setState({\n                    width: imgWidth,\n                    height: imgHeight\n                });\n            }\n        };\n\n        const img = e.target;\n        if (img) {\n            this.setState({\n                file2: e.target.files[0],\n                file: URL.createObjectURL(e.target.files[0])\n            })\n            this.faceRecognition(img.files[0]);\n        }\n        e.target.value = null;\n    }\n\n    // To show checkAttendence page .\n    setShowBtn = () => {\n        this.setState({\n            showUploadBtn: true\n        });\n    }\n\n    sendHistoryData = () => {\n        let requestOptions = {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                'ids': this.state.ids,\n                'imgs': this.state.imgs\n            }),\n        };\n        let baseUrl= document.getElementById('baseUrl').value;\n        fetch(`${baseUrl}/history/${this.state.selected_class}`, requestOptions)\n            .then(res => res.json())\n            .then(console.log)\n            .catch(e => { console.log(\"An Error occured while sending history Data ..\", e) });\n        let date = new Date();\n        let fullDate = date.getDate() + \"/\" + (date.getMonth() + 1) + \"/\" + date.getFullYear();\n        let historyData = {\n            students: this.state.ids,\n            allStudents: this.state.students,\n            imgs: this.state.imgs,\n            className: this.state.selected_class,\n            date: fullDate\n        };\n\n        this.setState({\n            ids: [],\n            imgs: [],\n            selected_class: [],\n            historyData: historyData,\n            disableButton: true,\n            route: '/show/details',\n        })\n    }\n\n    // To detect faces from an image .\n    faceRecognition = (img) => {\n\n        let formdata = new FormData();\n        formdata.append(\"photo\", img, \"file\");\n\n        let requestOptions = {\n            method: 'POST',\n            body: formdata,\n            redirect: 'follow'\n        };\n\n\n        let baseUrl= document.getElementById('baseUrl').value;\n        fetch(`${baseUrl}/checkImage`, requestOptions)\n            .then(response => response.json())\n            .then(result => {\n\n                console.log(result);\n                //Define canvas to draw rectangle .\n                let canvas = document.getElementById('canvas');\n                let ctx = canvas.getContext('2d');\n\n                //Canvas properties .\n                ctx.strokeStyle = 'yellow';\n                ctx.fillStyle = 'yellow';\n                ctx.lineWidth = '5';\n\n                //Change the background of context to the uploaded image .\n                let image = document.getElementById('person');\n                ctx.drawImage(image, 0, 0);\n                let studetnsIDs = this.state.students.map(std => {\n                    return std.id\n                });\n                let { ids } = this.state;\n                for (let i in result) {\n                    let name = result[i].name.substring(0, result[i].name.indexOf('|'));\n                    let id = result[i].name.substring(result[i].name.indexOf('|') + 2);\n                    if (!studetnsIDs.includes(id)) {\n                        continue;\n                    }\n                    if (result[i].probability * 100 < 90) {\n                        continue;\n                    }\n\n                    if (!ids.includes(id)) {\n                        ids.push(id);\n                    }\n\n                    //Get the values of Rectangle .\n                    let { left, right, bottom, top } = result[i].rectangle;\n\n                    //Determine the width and hight for rectangle .\n                    let Dim = (right - left);\n\n                    //Determine font size and the space between rectangle and text .\n                    let space = parseInt(Dim / 3),\n                        text = `${space}px Lobster`;\n                    ctx.font = text;\n\n                    //Draw the rectangle .\n                    ctx.strokeRect(left, top, Dim, Dim);\n\n                    //Type the name of person .\n                    ctx.fillText(name, left, bottom + space);\n                }\n\n                let attendStudents = [] ;\n                let absenceStudents = [] ;\n                for(let i of this.state.students){\n                    let flag = false ;\n                    for(let j of this.state.ids){\n                        if(i.id === j){\n                            flag = true ;\n                        }\n                    }\n                    if(flag){\n                        attendStudents.push({\n                            id : i.id ,\n                            name : i.name\n                        }) ;\n                    }\n                    else {\n                        absenceStudents.push({\n                            id : i.id ,\n                            name : i.name\n                        }) ;\n                    }\n                }\n\n                this.setState({\n                    ids: ids,\n                    attendStudents ,\n                    absenceStudents\n                    // imgs : [imagesLink]\n                });\n                let space = this.state.width / 20;\n                ctx.fillStyle = 'black';\n                let text = `${space}px serif`;\n                ctx.font = text;\n                ctx.fillText(new Date().toLocaleString(), (this.state.width / 2) - 5 * space, 50);\n                this.setState({ showImage: false });\n                // Store image in firebase ........\n                let dataURL = canvas.toDataURL(\"image/png\");\n                console.log(ids);\n                this.setState({\n                    file: dataURL\n                });\n\n                let formdata = this.getImageURL(dataURL);\n                this.convertImageToURL(formdata.get('image'));\n\n                console.log(\"Imgs : \", this.state.imgs);\n                this.colorTable(result);\n                this.setState({\n                    load: false\n                });\n\n            })\n            .catch(error => console.log('error', error));\n    };\n\n    getImageURL(dataURL) {\n        let blobBin = atob(dataURL.split(',')[1]);\n        let array = [];\n        for (let i = 0; i < blobBin.length; i++) {\n            array.push(blobBin.charCodeAt(i));\n        }\n        let file = new Blob([new Uint8Array(array)], { type: 'image/png' });\n        let formdata = new FormData();\n        formdata.append(\"image\", file);\n        return formdata;\n    }\n\n    convertImageToURL(image) {\n        if (image) {\n            let imageName = \"studentsImage\" + new Date().getTime();\n            const upload = storage.ref(`images/${imageName}`).put(image);\n            upload.on('state_changed',\n                (snapshot) => { },\n                (err) => {\n                    console.log(\"error while getting data from firebase.\\n\", err);\n                    return '';\n                },\n                () => {\n                    storage.ref('images').child(imageName).getDownloadURL().then(urll => {\n                        console.log(urll);\n\n                        let imgs = [].concat(this.state.imgs);\n                        imgs.push(urll);\n                        this.setState({\n                            imgs: imgs,\n                            doneDisable: false\n                        })\n                        return urll;\n                    })\n\n                })\n        }\n    }\n\n    // To change the row color according to the attendence .\n    colorTable = () => {\n        let { ids } = this.state;\n        for (let i of ids) {\n            let row = document.getElementById(i + \"\") ;\n            if(row){\n                row.className = 'bg-success text-light';\n            }\n        }\n    }\n\n    // Clear data from upload image and recolor the table .\n    clear = () => {\n        this.setState({\n            showImage: true,\n            showUploadBtn: false\n        });\n        let { students } = this.state;\n        for (let student of students) {\n            document.getElementById(student.id).className = '';\n        }\n    }\n\n    // Get the student of each class .\n    CheckClass = (e) => {\n        const name = e.target.getAttribute('data-class');\n        this.setState({\n            selected_class: name\n        })\n        let arr = []\n        this.state.classes.forEach(element => {\n            if (element.className === name) {\n                element.students.forEach((std) => {\n                    arr.push({ id: std.id_number, name: std.firstName + \" \" + std.lastName })\n                })\n            }\n        });\n        this.setState({\n            ids: [],\n            imgs: [],\n            students: arr,\n            hidePage: true,\n            showStudents : arr ,\n            route: '/show/classData'\n        })\n    }\n\n    editClass = () => {\n        this.setState({\n            direction: 'edit',\n            route: '/show/editClass'\n        });\n    }\n\n\n    // Back to the classes page .\n    back = () => {\n        this.setState({\n            hidePage: false,\n            route:'/show'\n        });\n        this.clear();\n    }\n\n    showHistoryPage = () => {\n        this.setState({\n            route: '/show/classHistory'\n        });\n    }\n\n    showAllStudents = () => {\n        let showStudents = this.state.students ;\n        this.setState({\n            showStudents\n        }) ;\n        this.colorTable() ;\n    }\n\n    showAttendStudents = () => {\n        let showStudents = this.state.attendStudents ;\n        this.setState({\n            showStudents\n        }) ;\n    }\n\n    showAbcentStudents = () => {\n        let showStudents = this.state.absenceStudents ;\n        this.setState({\n            showStudents\n        }) ;\n    }\n\n    onChangeRoute=(route)=>{\n        setTim\n        console.log(route , \"clicked\");\n        if(this.checkLoggedIn()){\n            let baseUrl= document.getElementById('baseUrl').value;\n            fetch(`${baseUrl}/teacherClasses?id=` + JSON.parse(sessionStorage.getItem('teacher')).id_number)\n                .then(res => res.json()).then(data => {\n                    this.setState({\n                        classes: data,\n                        route\n                    })\n                })\n                .catch(e => console.log(e));\n        }\n    }\n\n    render() {\n        let {path} = this.props.match;\n        let classInfo = {\n            'students': this.state.students,\n            'className': this.state.selected_class\n        };\n        let bgColors = ['bg-dark', 'bg-primary', 'bg-info', 'bg-success', 'bg-secondary'];\n        let rows = this.state.classes.map((cs) => {\n            const num = parseInt(Math.random() * bgColors.length);\n            const classNames = `${bgColors[num]} col-md-5 ml-1 class rounded mt-1 text-center text-light cursor`;\n            return (\n                <div onClick={this.CheckClass} key={cs._id} data-class={cs.className} data-student={cs.students} id={cs._id} className={classNames}>\n                    <h1 data-class={cs.className}>{cs.className}</h1>\n                    <p data-class={cs.className}>Students : {cs.students.length}</p>\n                </div>\n            )\n        });\n\n        \n\n\n        return (\n\n\n            <>\n                {this.state.route ? <Redirect to={this.state.route} /> : null}\n                <Route path={`${path}/editClass`} component={() => <EditClass classInfo={classInfo} onChangeRoute={this.onChangeRoute} />} />\n                <Route path={`${path}/classHistory`} component={() => <History selected_class={this.state.selected_class} />} />\n                <Route path={`${path}/details`} component={() => <Details historyData={this.state.historyData} />} />\n                <Route path={`${path}`} exact >\n                    <div className=\"container text-center\" >\n                        <h1 className=\"main-title\">Select A Class</h1>\n                        <div className=\"row d-flex justify-content-center\">\n                            {rows}\n                        </div>\n                    </div>\n                </Route>\n                <Route path={`${path}/classData`}>\n\n                    <div className=\"container\">\n                        {/* Spinner when get the result */}\n                        <div className=\"loading\" hidden={!this.state.load}>\n                            <div className=\"circle\"></div>\n                            <div className=\"circle\"></div>\n                            <div className=\"circle\"></div>\n                            <div className=\"circle\"></div>\n                        </div>\n                        <div className=\"d-flex justify-content-between\">\n                            <button hidden={this.state.load} onClick={this.editClass} className=\" mt4 btn btn-info shadow grow\" >Edit Students</button>\n                            <button hidden={this.state.load} onClick={this.showHistoryPage} className=\" mt4 btn btn-warning shadow grow\" >History</button>\n                        </div>\n                        <div className=\"row\" hidden={this.state.load}>\n\n                            {/* Student table */}\n\n                            <div className=\"col-md-6\">\n                                <h3 className=\"mt-2\" style={{ fontFamily: 'Lobster', color: '#343a40' }}>Student of the course</h3>\n                                <StudentsTable students={this.state.showStudents} />\n                                <div className=\"d-flex justify-content-around\">\n                                    <button onClick={this.showAllStudents} className=\"btn btn-dark br4 grow shadow dim\">All Students</button>\n                                    <button onClick={this.showAttendStudents} className=\"btn btn-success br4 grow shadow dim\">Attendance Students</button>\n                                    <button onClick={this.showAbcentStudents} className=\"btn btn-danger  br4 grow shadow dim\">Absence Students</button>\n                                </div>\n                            </div>\n                            {/* Face recognition */}\n                            <div className=\"col-md-6 align-self-center\">\n                                <img className=\"mt-2 grow pointer\" onClick={this.back} src=\"https://img.icons8.com/fluent/48/000000/circled-left.png\" alt=\"go back\" />\n                                <Button hidden={this.state.showUploadBtn} onClick={this.setShowBtn} style={{ width: '100%' }} className=\"btn f3 grow btn-dark btn-submit mt-4\">Check Attendence</Button>\n                                <div hidden={!this.state.showUploadBtn}>\n                                    <label htmlFor=\"file2\" style={{ width: '50%', backgroundColor: 'darkcyan' }} className=\"mt-3 grow f4 btn text-light btn-submit\">{(this.state.ids.length === 0) ? 'Check Image' : 'Check another Image'}</label>\n                                    <input hidden onChange={this.checkAttendence} type=\"file\" accept=\"image/*\" id=\"file2\" className=\"form-file mt-4\" required disabled={this.state.disableButton} />\n                                    <br />\n                                    <p hidden={!this.state.showImage} className=\"mt-5\" style={{ fontFamily: 'Acme' }}>To Check Attendence Upload an image for class student , then the system will check it .</p>\n                                    <p hidden={!this.state.showImage} style={{ fontFamily: 'Acme' }}><span className=\"bg-success p-1 text-light rounded\">Green</span> rows on table represents the Attendees student , and the <span className=\"bg-dark p-1 text-light rounded\">white</span> rows for Absence students . </p>\n\n                                    {/* Image will display the uploaded image , we use it to draw it on canvas . */}\n                                    <img hidden id=\"person\" src={this.state.file} alt=\"Person\" />\n\n                                    {/* Canvas will draw the image , rectangles and names . */}\n                                    <canvas id=\"canvas\" width={this.state.width} height={this.state.height} hidden></canvas>\n\n                                    {/* The final result will be shown on the img below , that we can edit it's width and height . */}\n                                    <img className=\"img-thumbnail mt-4\" src={this.state.file || noImage} alt=\"Person\" width=\"300\" height='300' hidden={this.state.showImage} />\n                                    <br />\n                                    <Button hidden={this.state.showImage} onClick={this.clear} style={{ width: '30%' }} className=\"btn f3 grow btn-warning btn-submit mt-4\">Clear</Button>\n                                    <a className=\"btn f3 grow btn-info btn-submit mt-4\" style={{ width: '30%' }} hidden={this.state.showImage} href={`${this.state.file}`} download>Download</a>\n                                    <br />\n                                    <Button hidden={this.state.showImage} onClick={this.sendHistoryData} style={{ width: '30%' }} className=\"btn f3 grow btn-success btn-submit mt-4 mb-4\" disabled={this.state.doneDisable}>Done</Button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </Route>\n\n\n            </>);\n    }\n}\nexport default MyClasses;\n"]},"metadata":{},"sourceType":"module"}